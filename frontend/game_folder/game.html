<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Phaser</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.87.0/dist/phaser.js"></script>
    <style type="text/css">
      body {
        margin: 0;
      }
    </style>
  </head>
  <body>
    <script type="module">
      import CollisionBlocks from "./collisionBlocks.js";
      import HouseCollisionBlocks from "./houseCollisionBlocks.js";
      import House2CollisionBlocks from "./house2CollisionBlocks.js";

      class MainScene extends Phaser.Scene {
        constructor() {
          super({ key: "Main" });
        }

        // Character positioning
        init(data) {
          // Defaults guy start position to 900/800 unless switching scene
          this.startX = data && data.x ? data.x : 500; // Default to 900 if no position passed
          this.startY = data && data.y ? data.y : 1300; // Default to 800 if no position passed
        }

        preload() {
          this.load.spritesheet("background", "assets/background.png", {
            frameWidth: 630,
            frameHeight: 500,
          });
          this.load.spritesheet("guy", "assets/Guy.png", {
            frameWidth: 32,
            frameHeight: 32,
          });
          this.load.image("collision", "assets/collision.png");
          this.load.image("roof1", "assets/rooftop.png");
          this.load.image("roof2", "assets/Rooftop2.1.png");
          this.load.audio("backgroundMusic", "assets/backgroundMusic.mp3"); // Background music
          this.load.image("barn", "assets/BarnHouse.png");
          this.load.image("w_well", "assets/WishingWell.png");
          this.load.image("door", "assets/door.png");
          this.load.audio("doorOpen", "assets/doorOpen.mp3");
          this.load.image("fountain", "assets/FountainSpout.png"); // Door sound
        }

        create() {
          // Character animations/frames

          this.anims.create({
            key: "guyidle",
            frames: this.anims.generateFrameNumbers("guy", {
              start: 0,
              end: 0,
            }),
            frameRate: 1,
          });

          this.anims.create({
            key: "background",
            frames: this.anims.generateFrameNumbers("background", {
              start: 0,
              end: 79,
            }),
            frameRate: 8,
            repeat: -1, // Loops through indefinitely
          });

          const background = this.add
            .sprite(0, 0, "background")
            .setOrigin(0, 0)
            .setScale(3.2); // How zoomed in the map is

          background.play("background");

          this.roof = this.add
            .image(1251, 432, "roof1")
            .setOrigin(0, 0)
            .setDepth(10)
            .setScale(0.5);
          this.roof1 = this.add
            .image(334, 943, "roof2")
            .setOrigin(0, 0)
            .setDepth(10)
            .setScale(0.59);

          this.door = this.add
            .image(1165, 1060, "door")
            .setOrigin(0, 0)
            .setScale(1.57);

          this.barn = this.add
            .image(60, 628, "barn")
            .setOrigin(0, 0)
            .setDepth(10)
            .setScale(0.59);
          this.well = this.add
            .image(1120, 535, "w_well")
            .setOrigin(0, 0)
            .setDepth(10)
            .setScale(0.59);

          this.fountain = this.add
            .image(945, 820, "fountain")
            .setOrigin(0, 0)
            .setDepth(10)
            .setScale(0.59);

          this.player = this.physics.add
            .sprite(this.startX, this.startY, "guy")
            .setSize(18, 10)
            .setScale(2.5) // Size of character
            .setOrigin(0, 0) // Do not change
            .setOffset(6.5, 14); // Do not change

          this.player.setCollideWorldBounds(true);

          this.anims.create({
            key: "left",
            frames: this.anims.generateFrameNumbers("guy", {
              start: 24,
              end: 29,
            }),
            frameRate: 10,
            repeat: -1,
          });

          this.anims.create({
            key: "right",
            frames: this.anims.generateFrameNumbers("guy", {
              start: 24,
              end: 29,
            }),
            frameRate: 10,
            repeat: -1,
          });

          this.anims.create({
            key: "up",
            frames: this.anims.generateFrameNumbers("guy", {
              start: 30,
              end: 35,
            }),
            frameRate: 10,
            repeat: -1,
          });

          this.anims.create({
            key: "down",
            frames: this.anims.generateFrameNumbers("guy", {
              start: 18,
              end: 23,
            }),
            frameRate: 10,
            repeat: -1,
          });

          // Collision and door data for MainScene
          const collisionBlocks = new CollisionBlocks(this);
          const collisionGroup = collisionBlocks.getBlocks();
          this.physics.add.collider(this.player, collisionGroup);

          // Door Area for MainScene
          this.doorArea = this.physics.add.staticGroup();
          const door1 = this.doorArea
            .create(495, 665, "collision")
            .setSize(40, 60)
            .setOrigin(1, 1); // House door TL
          door1.visible = false;
          door1.setData("targetScene", "House1");

          const door2 = this.doorArea
            .create(1161, 355, "collision")
            .setSize(40, 60)
            .setOrigin(1, 1); // House door TR
          door2.visible = false;
          door2.setData("targetScene", "House2");

          const door3 = this.doorArea
            .create(1315, 700, "collision")
            .setSize(40, 60)
            .setOrigin(1, 1); // House door TR
          door3.visible = false;
          door3.setData("targetScene", "House3");

          const door4 = this.doorArea
            .create(1225, 1125, "collision")
            .setSize(40, 60)
            .setOrigin(1, 1); // House door TR
          door4.visible = false;
          door4.setData("targetScene", "House4");

          const door5 = this.doorArea
            .create(535, 1270, "collision")
            .setSize(40, 60)
            .setOrigin(1, 1); // House door TR
          door5.visible = false;
          door5.setData("targetScene", "House5");

          this.doorOpenSound = this.sound.add("doorOpen", { volume: 0.5 });

          this.physics.add.collider(
            this.player,
            this.doorArea,
            (player, doorArea) => {
              const targetScene = doorArea.getData("targetScene");
              if (targetScene) {
                this.doorOpenSound.play();
                console.log(`You are close to the ${targetScene} door!`);
                this.scene.start(targetScene);
              }
            },
            null,
            this
          );

          // World bounds and camera
          this.physics.world.setBounds(0, 0, 2000, 1600);
          this.cameras.main.setBounds(0, 0, 2000, 1600);
          this.cameras.main.startFollow(this.player);

          this.cursors = this.input.keyboard.createCursorKeys();

          if (!this.sound.get("backgroundMusic")) {
            this.backgroundMusic = this.sound.add("backgroundMusic", {
              loop: true,
              volume: 0.0,
            });
            this.backgroundMusic.play();
          } else {
            const backgroundMusic = this.sound.get("backgroundMusic");
            if (!backgroundMusic.isPlaying) {
              backgroundMusic.play();
            }
          }
        }

        update() {
          this.player.setVelocity(0);

          if (this.cursors.left.isDown) {
            this.player.setVelocityX(-160);
            this.player.anims.play("right", true);
            this.player.setFlipX(true);
          } else if (this.cursors.right.isDown) {
            this.player.setVelocityX(160);
            this.player.anims.play("right", true);
            this.player.setFlipX(false);
          }

          if (this.player.body.velocity.x === 0) {
            if (this.cursors.up.isDown) {
              this.player.setVelocityY(-160);
              this.player.anims.play("up", true);
            } else if (this.cursors.down.isDown) {
              this.player.setVelocityY(160);
              this.player.anims.play("down", true);
            }
          }

          if (
            this.player.body.velocity.x === 0 &&
            this.player.body.velocity.y === 0
          ) {
            this.player.anims.play("guyidle", true);
          }
        }
      }

      class HouseScene1 extends Phaser.Scene {
        constructor() {
          super({ key: "House1" });
        }

        preload() {
          this.load.image("house2", "assets/house2.png");
          this.load.spritesheet("guy", "assets/guy.png", {
            frameWidth: 32,
            frameHeight: 32,
          });
          this.load.image("collision", "assets/collision.png");
          this.doorOpenSound = this.sound.add("doorOpen", { volume: 0.5 });
        }

        create() {
          // Stop BG Music in House
          const backgroundMusic = this.sound.get("backgroundMusic");
          if (backgroundMusic) {
            backgroundMusic.stop();
          }

          this.cursors = this.input.keyboard.createCursorKeys();

          // House image
          this.add.image(0, 0, "house2").setOrigin(0, 0).setScale(0.5);

          this.player = this.physics.add
            .sprite(200, 300, "guy")
            .setSize(18, 10)
            .setScale(3.5)
            .setOrigin(0, 0)
            .setOffset(6.5, 14);

          this.player.setCollideWorldBounds(true);

          // House collision and door data for HouseScene
          const houseCollisionBlocks = new HouseCollisionBlocks(this);
          const houseCollisionGroup = houseCollisionBlocks.getHouseBlocks();
          this.physics.add.collider(this.player, houseCollisionGroup);

          // Door Area for HouseScene
          this.doorArea = this.physics.add.staticGroup();
          const houseDoor = this.doorArea
            .create(250, 160, "collision")
            .setSize(30, 70);
          houseDoor.visible = false;

          this.physics.add.collider(
            this.player,
            this.doorArea,
            function (player, doorArea) {
              console.log("You are at the door!");
              this.doorOpenSound.play();
              this.scene.start("Main", { x: 500, y: 685 });
            },
            null,
            this
          );

          // World bounds and camera
          this.physics.world.setBounds(0, 0, 500, 800);
          this.cameras.main.setBounds(0, 0, 500, 800);
        }

        update() {
          this.player.setVelocity(0);

          if (this.cursors.left.isDown) {
            this.player.setVelocityX(-160);
            this.player.anims.play("right", true);
            this.player.setFlipX(true);
          } else if (this.cursors.right.isDown) {
            this.player.setVelocityX(160);
            this.player.anims.play("right", true);
            this.player.setFlipX(false);
          }

          if (this.player.body.velocity.x === 0) {
            if (this.cursors.up.isDown) {
              this.player.setVelocityY(-160);
              this.player.anims.play("up", true);
            } else if (this.cursors.down.isDown) {
              this.player.setVelocityY(160);
              this.player.anims.play("down", true);
            }
          }

          if (
            this.player.body.velocity.x === 0 &&
            this.player.body.velocity.y === 0
          ) {
            this.player.anims.play("guyidle", true);
          }
        }
      }

      class HouseScene2 extends Phaser.Scene {
        constructor() {
          super({ key: "House2" });
        }

        preload() {
          this.load.image("house1", "assets/house1.png");
          this.load.spritesheet("guy", "assets/guy.png", {
            frameWidth: 32,
            frameHeight: 32,
          });
          this.load.image("collision", "assets/collision.png");
          this.doorOpenSound = this.sound.add("doorOpen", { volume: 0.5 });
        }

        create() {
          // Stop BG Music in House
          const backgroundMusic = this.sound.get("backgroundMusic");
          if (backgroundMusic) {
            backgroundMusic.stop();
          }

          this.cursors = this.input.keyboard.createCursorKeys();

          // House image
          this.add.image(0, 0, "house1").setOrigin(0, 0).setScale(0.5);

          this.player = this.physics.add
            .sprite(200, 300, "guy")
            .setSize(18, 10)
            .setScale(3.5)
            .setOrigin(0, 0)
            .setOffset(6.5, 14);

          this.player.setCollideWorldBounds(true);

          // House collision and door data for HouseScene
          const house2CollisionBlocks = new House2CollisionBlocks(this);
          const house2CollisionGroup = house2CollisionBlocks.getHouse2Blocks();
          this.physics.add.collider(this.player, house2CollisionGroup);

          // Door Area for HouseScene
          this.doorArea = this.physics.add.staticGroup();
          const houseDoor = this.doorArea
            .create(393, 205, "collision")
            .setSize(10, 70);
          houseDoor.visible = false;

          this.physics.add.collider(
            this.player,
            this.doorArea,
            function (player, doorArea) {
              console.log("You are at the door!");
              this.doorOpenSound.play();
              this.scene.start("Main", { x: 1100, y: 375 });
            },
            null,
            this
          );

          // World bounds and camera
          this.physics.world.setBounds(0, 0, 500, 800);
          this.cameras.main.setBounds(0, 0, 500, 800);
        }

        update() {
          this.player.setVelocity(0);

          if (this.cursors.left.isDown) {
            this.player.setVelocityX(-160);
            this.player.anims.play("right", true);
            this.player.setFlipX(true);
          } else if (this.cursors.right.isDown) {
            this.player.setVelocityX(160);
            this.player.anims.play("right", true);
            this.player.setFlipX(false);
          }

          if (this.player.body.velocity.x === 0) {
            if (this.cursors.up.isDown) {
              this.player.setVelocityY(-160);
              this.player.anims.play("up", true);
            } else if (this.cursors.down.isDown) {
              this.player.setVelocityY(160);
              this.player.anims.play("down", true);
            }
          }

          if (
            this.player.body.velocity.x === 0 &&
            this.player.body.velocity.y === 0
          ) {
            this.player.anims.play("guyidle", true);
          }
        }
      }

      class HouseScene3 extends Phaser.Scene {
        constructor() {
          super({ key: "House3" });
        }

        preload() {
          this.load.image("house1", "assets/house1.png");
          this.load.spritesheet("guy", "assets/guy.png", {
            frameWidth: 32,
            frameHeight: 32,
          });
          this.load.image("collision", "assets/collision.png");
          this.doorOpenSound = this.sound.add("doorOpen", { volume: 0.5 });
        }

        create() {
          // Stop BG Music in House
          const backgroundMusic = this.sound.get("backgroundMusic");
          if (backgroundMusic) {
            backgroundMusic.stop();
          }

          this.cursors = this.input.keyboard.createCursorKeys();

          // House image
          this.add.image(0, 0, "house1").setOrigin(0, 0).setScale(0.5);

          this.player = this.physics.add
            .sprite(200, 300, "guy")
            .setSize(18, 10)
            .setScale(3.5)
            .setOrigin(0, 0)
            .setOffset(6.5, 14);

          this.player.setCollideWorldBounds(true);

          // House collision and door data for HouseScene
          const house2CollisionBlocks = new House2CollisionBlocks(this);
          const house2CollisionGroup = house2CollisionBlocks.getHouse2Blocks();
          this.physics.add.collider(this.player, house2CollisionGroup);

          // Door Area for HouseScene
          this.doorArea = this.physics.add.staticGroup();
          const houseDoor = this.doorArea
            .create(393, 205, "collision")
            .setSize(10, 70);
          houseDoor.visible = false;

          this.physics.add.collider(
            this.player,
            this.doorArea,
            function (player, doorArea) {
              console.log("You are at the door!");
              this.doorOpenSound.play();
              this.scene.start("Main", { x: 1275, y: 715 });
            },
            null,
            this
          );

          // World bounds and camera
          this.physics.world.setBounds(0, 0, 500, 800);
          this.cameras.main.setBounds(0, 0, 500, 800);
        }

        update() {
          this.player.setVelocity(0);

          if (this.cursors.left.isDown) {
            this.player.setVelocityX(-160);
            this.player.anims.play("right", true);
            this.player.setFlipX(true);
          } else if (this.cursors.right.isDown) {
            this.player.setVelocityX(160);
            this.player.anims.play("right", true);
            this.player.setFlipX(false);
          }

          if (this.player.body.velocity.x === 0) {
            if (this.cursors.up.isDown) {
              this.player.setVelocityY(-160);
              this.player.anims.play("up", true);
            } else if (this.cursors.down.isDown) {
              this.player.setVelocityY(160);
              this.player.anims.play("down", true);
            }
          }

          if (
            this.player.body.velocity.x === 0 &&
            this.player.body.velocity.y === 0
          ) {
            this.player.anims.play("guyidle", true);
          }
        }
      }

      class HouseScene4 extends Phaser.Scene {
        constructor() {
          super({ key: "House4" });
        }

        preload() {
          this.load.image("house2", "assets/house2.png");
          this.load.spritesheet("guy", "assets/guy.png", {
            frameWidth: 32,
            frameHeight: 32,
          });
          this.load.image("collision", "assets/collision.png");
          this.doorOpenSound = this.sound.add("doorOpen", { volume: 0.5 });
        }

        create() {
          // Stop BG Music in House
          const backgroundMusic = this.sound.get("backgroundMusic");
          if (backgroundMusic) {
            backgroundMusic.stop();
          }

          this.cursors = this.input.keyboard.createCursorKeys();

          // House image
          this.add.image(0, 0, "house2").setOrigin(0, 0).setScale(0.5);

          this.player = this.physics.add
            .sprite(200, 300, "guy")
            .setSize(18, 10)
            .setScale(3.5)
            .setOrigin(0, 0)
            .setOffset(6.5, 14);

          this.player.setCollideWorldBounds(true);

          // House collision and door data for HouseScene
          const houseCollisionBlocks = new HouseCollisionBlocks(this);
          const houseCollisionGroup = houseCollisionBlocks.getHouseBlocks();
          this.physics.add.collider(this.player, houseCollisionGroup);

          // Door Area for HouseScene
          this.doorArea = this.physics.add.staticGroup();
          const houseDoor = this.doorArea
            .create(255, 170, "collision")
            .setSize(10, 70);
          houseDoor.visible = false;

          this.physics.add.collider(
            this.player,
            this.doorArea,
            function (player, doorArea) {
              console.log("You are at the door!");
              this.doorOpenSound.play();
              this.scene.start("Main", { x: 1185, y: 1135 });
            },
            null,
            this
          );

          // World bounds and camera
          this.physics.world.setBounds(0, 0, 500, 800);
          this.cameras.main.setBounds(0, 0, 500, 800);
        }

        update() {
          this.player.setVelocity(0);

          if (this.cursors.left.isDown) {
            this.player.setVelocityX(-160);
            this.player.anims.play("right", true);
            this.player.setFlipX(true);
          } else if (this.cursors.right.isDown) {
            this.player.setVelocityX(160);
            this.player.anims.play("right", true);
            this.player.setFlipX(false);
          }

          if (this.player.body.velocity.x === 0) {
            if (this.cursors.up.isDown) {
              this.player.setVelocityY(-160);
              this.player.anims.play("up", true);
            } else if (this.cursors.down.isDown) {
              this.player.setVelocityY(160);
              this.player.anims.play("down", true);
            }
          }

          if (
            this.player.body.velocity.x === 0 &&
            this.player.body.velocity.y === 0
          ) {
            this.player.anims.play("guyidle", true);
          }
        }
      }

      class HouseScene5 extends Phaser.Scene {
        constructor() {
          super({ key: "House5" });
        }

        preload() {
          this.load.image("house2", "assets/house2.png");
          this.load.spritesheet("guy", "assets/guy.png", {
            frameWidth: 32,
            frameHeight: 32,
          });
          this.load.image("collision", "assets/collision.png");
          this.doorOpenSound = this.sound.add("doorOpen", { volume: 0.5 });
        }

        create() {
          // Stop BG Music in House
          const backgroundMusic = this.sound.get("backgroundMusic");
          if (backgroundMusic) {
            backgroundMusic.stop();
          }

          this.cursors = this.input.keyboard.createCursorKeys();

          // House image
          this.add.image(0, 0, "house2").setOrigin(0, 0).setScale(0.5);

          this.player = this.physics.add
            .sprite(200, 300, "guy")
            .setSize(18, 10)
            .setScale(3.5)
            .setOrigin(0, 0)
            .setOffset(6.5, 14);

          this.player.setCollideWorldBounds(true);

          // House collision and door data for HouseScene
          const houseCollisionBlocks = new HouseCollisionBlocks(this);
          const houseCollisionGroup = houseCollisionBlocks.getHouseBlocks();
          this.physics.add.collider(this.player, houseCollisionGroup);

          // Door Area for HouseScene
          this.doorArea = this.physics.add.staticGroup();
          const houseDoor = this.doorArea
            .create(250, 160, "collision")
            .setSize(30, 70);
          houseDoor.visible = false;

          this.physics.add.collider(
            this.player,
            this.doorArea,
            function (player, doorArea) {
              console.log("You are at the door!");
              this.doorOpenSound.play();
              this.scene.start("Main", { x: 500, y: 1300 });
            },
            null,
            this
          );
 
          // World bounds and camera
          this.physics.world.setBounds(0, 0, 500, 800);
          this.cameras.main.setBounds(0, 0, 500, 800);
        }

        update() {
          this.player.setVelocity(0);

          if (this.cursors.left.isDown) {
            this.player.setVelocityX(-160);
            this.player.anims.play("right", true);
            this.player.setFlipX(true);
          } else if (this.cursors.right.isDown) {
            this.player.setVelocityX(160);
            this.player.anims.play("right", true);
            this.player.setFlipX(false);
          }

          if (this.player.body.velocity.x === 0) {
            if (this.cursors.up.isDown) {
              this.player.setVelocityY(-160);
              this.player.anims.play("up", true);
            } else if (this.cursors.down.isDown) {
              this.player.setVelocityY(160);
              this.player.anims.play("down", true);
            }
          }

          if (
            this.player.body.velocity.x === 0 &&
            this.player.body.velocity.y === 0
          ) {
            this.player.anims.play("guyidle", true);
          }
        }
      }

      // Game configuration
      var config = {
        type: Phaser.AUTO,
        width: 1000,
        height: 600,
        physics: {
          default: "arcade",
          arcade: {
            debug: true, // Set to true to debug/see hitboxes
          },
        },
        scene: [MainScene, HouseScene1, HouseScene2, HouseScene3, HouseScene4, HouseScene5],
      };

      var game = new Phaser.Game(config);
    </script>
  </body>
</html>
